Η επίλυση του προβλήματος \ref{prob:02_05}, δηλαδή της ευθυγράμμισης
πραγματικών σαρώσεων, μέσω της ευθυγράμμισης πραγματικών με εικονικές σαρώσεις
είναι δυνατή και βασίζεται εξ ολοκλήρου στην εξής παρατήρηση:

Έστω οι προϋποθέσεις του προβλήματος \ref{prob:02_04} και $\bm{M}$ ο δεδομένος
χάρτης, του οποίου το μέγεθος ας είναι αυθαίρετα μεγάλο. Έστω $\hat{\bm{p}}_0 =
\hat{\bm{p}}$ και $\hat{\bm{p}}_N = \hat{\bm{p}}^\prime$ η αρχική και τελική
εκτίμηση της στάσης του αισθητήρα αντίστοιχα, και $\hat{\mathcal{P}}_\odot =
\{\hat{\bm{p}}_1, \hat{\bm{p}}_2,\dots, \hat{\bm{p}}_{N-1}\}$ το σύνολο των
ενδιάμεσων εκτιμήσεων στάσης που παράγονται στο εσωτερικό των μεθόδων
ευθυγράμμισης πραγματικών με εικονικές σαρώσεις. Τότε, εάν η τελική εκτίμηση
είναι συγκλίνουσα, δεδομένης---και ακριβώς λόγω---της προϋπόθεσης ότι η θέση
της εκτίμησης $\hat{\bm{p}}_0$ βρίσκεται σε μία γειτονιά της πραγματικής θέσης
του αισθητήρα, \textit{όλες οι εικονικές σαρώσεις που υπολογίζονται από τις
εκτιμήσεις του συνόλου $\hat{\bm{p}}_0 \cup \hat{\mathcal{P}}_\odot \cup
\hat{\bm{p}}_N$ υπολογίζονται με κέντρο μία γειτονιά της πραγματικής θέσης, και
συνεπώς (αναλόγως και της γεωμετρίας του περιβάλλοντος) αποτελούν προσεγγίσεις
της πραγματικής σάρωσης}. Κατά συνέπεια ο χάρτης $\bm{M}$ μπορεί να
αντικατασταθεί από την προβολή της μίας εκ των δύο σαρώσεων στο δισδιάστατο
επίπεδο---και λόγω της απουσίας σταθερού συστήματος συντεταγμένων γύρω από μία
αυθαίρετη στάση---,η οποία συνιστά μία τοπική προσέγγιση $\widetilde{\bm{M}}$
του περιβάλλοντος.

Κατά συνέπεια το πρόβλημα \ref{prob:02_05} είναι επιλύσιμο μέσω της λύσης του
προβλήματος \ref{prob:02_04}, και επομένως είναι δυνατόν να χρησιμοποιηθεί
οποιαδήποτε όψη \texttt{rc} της μεθόδου FSMSM που σχεδιάσαμε στο προηγούμενο
κεφάλαιο. Ο αλγόριθμος \ref{alg:algorithm_fsm} παρουσιάζει σε ψευδοκώδικα τα
βήματα εκτέλεσης του Fourier Scan Matcher (FSM). Ο αλγόριθμος
\ref{alg:algorithm_fsm} είναι ίδιος με τον αλγόριθμο \ref{alg:algorithm_fsmsm},
αλλά διαφέρει σε τρία σημεία: (α) οι είσοδοί του καθορίζονται από τα δεδομένα
του προβλήματος \ref{prob:02_05}, και όχι από αυτά του \ref{prob:02_04}, (β) ο
επονομαζόμενος και λειτουργών ως χάρτης $\widetilde{\bm{M}}$ είναι υπολογιστέος
από τη σάρωση $\mathcal{S}_0$ (γραμμή \ref{fsm:a}), και (γ) εκλείπει το
κριτήριο τερματισμού (Αλγόριθμος
\ref{alg:algorithm_fsmsm}:\ref{alg:fsmsm_termination_criterion_start}-\ref{alg:fsmsm_termination_criterion_end}).
Η αφαίρεση του τελευταίου έχει γίνει για λόγους οικονομίας πράξεων και
οδηγείται από την απαίτηση υπολογισμού της εκτίμησης του μετασχηματισμού
$\bm{T} = \bm{p}_1$$|_{\mathcal{S}_1}$$ - \bm{p}_0$$|_{\mathcal{S}_0}$ σε χρόνο
τέτοιο που να συμβαδίζει με το ρυθμό ανανέωσης των μετρήσεων του, ο οποίος
είναι εν γένει πολύ μεγαλύτερος από αυτόν με τον οποίο μία μέθοδος
παρακολούθησης της στάσης ενός ρομπότ ανανεώνει τις εκτιμήσεις της,\footnote{Η
συχνότητα ανανέωσης των αισθητήρων απόστασης κυμαίνεται από $10$ έως $20$ Hz
\cite{velodyne_datasheet,a2m8_datasheet,ydlidar}, και συνεπώς από μία
οποιαδήποτε μέθοδο ευθυγράμμισης σαρώσεων απαιτείται να είναι ικανή να
εκτελείται σε λιγότερο από $50$ ms.} όπου με $\bm{p}_1$$|_{\mathcal{S}_1}$ και
$\bm{p}_0$$|_{\mathcal{S}_0}$ σημειώνονται οι στάσεις από τις οποίες
συνελήφθησαν οι μετρήσεις $\mathcal{S}_1$ και $\mathcal{S}_0$ αντίστοιχα.
Στον αλγόριθμο \ref{alg:algorithm_fsm} η τελική εκτίμηση $\hat{\bm{p}}_1 =
\hat{\bm{T}}$, δεδομένου ότι η αρχική εκτίμηση $\hat{\bm{p}}_1 = (0,0,0)$ (γραμμή
\ref{fsm:initp}).

\begin{algorithm}
  \caption{\texttt{fsm}}
  \label{alg:algorithm_fsm}
  \begin{spacing}{1.2}
  \begin{algorithmic}[1]
    \REQUIRE $\mathcal{S}_0$, $\mathcal{S}_1$, $\gamma$, $N_s$, \texttt{rc}, $\nu_{\min}$, $\nu_{\max}$, $I_T$, $\varepsilon_{\delta p}$
    \ENSURE $\hat{\bm{p}}_1(\hat{x}_1, \hat{y}_1, \hat{\theta}_1)$
    \STATE $\hat{\bm{p}}_1 \leftarrow (0,0,0)$ \label{fsm:initp}
    \STATE $\widetilde{\bm{M}} \leftarrow \texttt{project\_to\_2d}(\mathcal{S}_0, \hat{\bm{p}}_1)$ \label{fsm:a}
    \STATE $\nu \leftarrow \nu_{\min}$
    \WHILE {$\nu \leq \nu_{\max}$}
      \STATE $\hat{\bm{p}}_1^C\leftarrow \texttt{caer-based\_orientation\_estimation}(\texttt{rc}, \widetilde{\bm{M}}, \mathcal{S}_1, \hat{\bm{p}}_1, \gamma, N_s, \nu)$ \hfill (Αλγ. \ref{alg:02_04_04:rc})
      \STATE $\hat{\bm{p}}_1^{\prime} \leftarrow \texttt{tc\_x1}(\widetilde{\bm{M}}, \mathcal{S}_1, \hat{\bm{p}}_1^C, I_T, \infty, N_s)$  \hfill (Αλγόριθμος \ref{alg:icte})
      \IF{$\hat{\bm{p}}_1^{\prime}$ not in $\widetilde{\bm{M}}$}
        \STATE generate new $\hat{\bm{p}}_1$; $\nu \leftarrow \nu_{\min}$; \texttt{continue}
      \ENDIF
      \IF{$ \|\hat{\bm{p}}_1^{\prime} - \hat{\bm{p}}_1\| < \varepsilon_{\delta p}$}
        \STATE $\nu \leftarrow \nu + 1$
      \ENDIF
      \STATE $\hat{\bm{p}}_1 \leftarrow \hat{\bm{p}}_1^{\prime}$
    \ENDWHILE
    \RETURN $\hat{\bm{p}}_1$
  \end{algorithmic}
  \end{spacing}
\end{algorithm}
