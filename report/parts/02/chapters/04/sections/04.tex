Οι δύο προηγούμενες ενότητες περιγράφουν μεθόδους ελάττωσης (α) του σφάλματος
εκτίμησης προσανατολισμού όταν η εκτίμηση θέσης συμπίπτει με τη θέση του
αισθητήρα, και (β) του σφάλματος εκτίμησης θέσης όταν η εκτίμηση
προσανατολισμού ισούται με τον προσανατολισμό του αισθητήρα. Ωστόσο στη γενική
περίπτωση καμία ισότητα δεν ισχύει. Επιπρόσθετα, στη γενική περίπτωση
διαταραχές επηρεάζουν τις μετρήσεις του φυσικού αισθητήρα αποστάσεων και το
βαθμό ταύτισης του χάρτη $\bm{M}$ ως προς το περιβάλλον που αναπαριστά.

Οι τελευταίες δύο προτάσεις είναι κρίσιμης σημασίας για την από κοινού επίδοση
των μεθόδων που παρουσιάστηκαν στις προηγούμενες δύο ενότητες, λόγω των
περιορισμών των ενοτήτων \ref{subsection:02_04_02:07} και
\ref{subsection:02_04_03:02}, και της Παρατήρησης \ref{rem:iterative}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Αντιμετώπιση των υπό γενικές συνθήκες γωνιακών περιορισμών}
\label{subsection:02_04_04:01}

Η παράκαμψη ή ο μετριασμός των επιδράσεων των περιορισμών που εμφανίζουν οι
μέθοδοι ευθυγράμμισης σε γενικές συνθήκες ανισότητας στάσεων και διαταραχών
στοχεύει στη λύση δύο ειδών προβλημάτων, δεδομένων των ιδιοτήτων των
Παρατηρήσεων \ref{remark:02_04_02:01} και \ref{remark:loc_prop_or}:

\begin{itemize}
  \item Το πρώτο αφορά αποκλειστικά στη μέθοδο εκτίμησης προσανατολισμού
        Πρώτων Αρχών, και περιγράφεται στην Παρατήρηση \ref{remark:02_04_02:02}
  \item Το δεύτερο πρόβλημα αφορά στις συγγενείς Παρατηρήσεις
        \ref{remark:02_04_02:03} και \ref{remark:02_04_02:04}
  %\item Το τρίτο πρόβλημα αφορά σε όλες τις μεθόδους εκτίμησης προσανατολισμού,
        %και συγκεκριμένα στην Παρατήρηση \ref{remark:02_04_02:01}
  %\item Το τέταρτο πρόβλημα αφορά αποκλειστικά στη μέθοδο εκτίμησης θέσης, και
        %συγκεκριμένα στην Παρατήρηση \ref{remark:loc_prop_or}
\end{itemize}

%Το τελευταίο αυτό πρόβλημα αποτελεί ιδιότητα της μεθόδου ευθυγράμμισης θέσης,
%και η αντιμετώπισή του είναι συνέπεια της λύσης των πρώτων τριών προβλημάτων.
%Με άλλα λόγια, εαν επιλυθούν τα πρώτα τρία προβλήματα, τότε αυτομάτως
%επιλύεται και το τέταρτο. Ταυτόχρονα, λόγω της επαναληπτικής φύσεως της
%από κοινού μεθοδολογίας ευθυγράμμισης (Παρατήρηση \ref{rem:iterative}),
%η επίλυση του τέταρτου προβλήματος επικουρεί στην επίλυση του τρίτου. \\

Δεδομένου ότι όλες οι μέθοδοι εκτίμησης προσανατολισμού επηρεάζονται από την
έλλειψη μηχανισμού σύγκρισης εκτιμήσεων ως προς το σφάλμα τους, προσεγγίζουμε
τη λύση των τριών πρώτων προβλημάτων με τον ακόλουθο κοινό τρόπο.

Έστω ότι προσθέτουμε στη μέθοδο εκτίμησης προσανατολισμού Πρώτων Αρχών την
λειτουργία δειγματοληψίας του χάρτη που παρουσιάστηκε στην ενότητα
\ref{subsection:02_04_02:06}. Έστω επίσης ότι αφαιρούμε από τη μέθοδο του Θησέα
τη λειτουργία υπολογισμού και σύγκρισης των τιμών της μετρικής Ποσοστού
Διάκρισης για κάθε εκτιμώμενη εκτίμηση προσανατολισμού (λόγω της σε γενικές
συνθήκες μη αύξουσας αντιστοιχίας του μέγιστου ποσοστού διάκρισης στο ελάχιστο
σφάλμα εκτίμησης προσανατολισμού---Παρατήρηση \ref{remark:02_04_02:04}). Τότε
οι τρεις μέθοδοι γίνονται εναλλάξιμες υπό την έννοια ότι, για μία δεδομένη
εκτίμησης στάσης και ένα δεδομένο βαθμό δειγματοληψίας $\nu$, καθεμία παράγει
ένα σύνολο εκτιμήσεων στάσης μεγέθους $2^\nu$.

Αυτό που επιζητούμε σε αυτό το στάδιο είναι η εφεύρεση ενός μέτρου σύγκρισης
των $2^\nu$ εκτιμήσεων προσανατολισμού ως προς το (άγνωστο) σφάλμα τους. Το
μέτρο σύγκρισης θα πρέπει να αντικατοπτρίζει τις ιδιότητες που περιγράφονται
από τις παρατηρήσεις \ref{remark:02_04_02:01} και \ref{remark:loc_prop_or},
και συνεπώς τα κριτήρια που πρέπει να ικανοποιεί αυτή η μετρική θα είναι, με
βάση τα παραπάνω, τα ακόλουθα δύο:

\begin{itemize}
  \item[(K1)] Δεδομένης της παρατήρησης \ref{remark:loc_prop_or}, η μετρική θα
        πρέπει για δεδομένο σφάλμα θέσης να αυξάνει για αυξανόμενο μέτρο
        σφάλματος προσανατολισμού
  \item[(K2)] Δεδομένης της παρατήρησης \ref{remark:02_04_02:01}, η μετρική θα
        πρέπει για δεδομένο σφάλμα προσανατολισμού να αυξάνει για αυξανόμενο
        μέτρο σφάλματος θέσης
\end{itemize}

Για την ικανοποίηση των Κ1 και Κ2 εισάγουμε τη μετρική Cummulative Absolute
Error per Ray (CAER), η οποία δίνεται από την εξίσωση (\ref{eq:caer_normal}),
και παριστάνεται γραφικά στο σχήμα \ref{fig:02_04_04:caer} για μεταβλητές τιμές
διαταραχών των μετρήσεων του φυσικού αισθητήρα και επίπεδα διαφθοράς του χάρτη
ως προς το περιβάλλον που αναπαριστά, σε αντιστοιχία με το σχήμα
\ref{fig:02_04_02:errorbar_x1}.
\begin{align}
  \text{CAER}(\mathcal{S}_R, \mathcal{S}_V) \triangleq & \sum\limits_{n=0}^{N_s-1} \Bigg|
    \mathcal{S}_R[n]\Big|_{(x, y, \theta)} -
    \mathcal{S}_V[n]\Big|_{(\hat{x}, \hat{y}, \hat{\theta})} \Bigg|
  \label{eq:caer_normal}
\end{align}

\begin{figure}
  \begin{subfigure}{\linewidth}\hspace{1cm}
    \input{./figures/parts/02/chapters/04/sections/04/caer_x2_sm0.tex}
    \vspace{0.25cm}
    \caption{\small $\sigma_{\bm{M}} = 0.0$ m}
    \vspace{0.5cm}
  \end{subfigure}\\%
  \begin{subfigure}{\linewidth}\hspace{1cm}
    \input{./figures/parts/02/chapters/04/sections/04/caer_x2_sm5.tex}
    \vspace{0.25cm}
    \caption{\small $\sigma_{\bm{M}} = 0.05$ m}
    \vspace{0.5cm}
  \end{subfigure}%
  \vspace{-0.25cm}
  \caption{\small Κατόψεις (πρώτη και τρίτη σειρά) και πλάγιες όψεις
           (δεύτερη και τέταρτη) της μετρικής CAER (εξίσωση
           \ref{eq:caer_normal}) από $10^5$ ζεύγη μίας σάρωσης σταθερής στάσης
           και εικονικών σαρώσεων που συνελήφθησαν από τυχαίες στάσεις, ανάλογα
           με την απόσταση $\|\Delta \bm{l}\|_2 = (\Delta x^2 + \Delta
           y^2)^{1/2}$, $\Delta x, \Delta y \in [-0.2, +0,2]$ m, και το
           σχετικού προσανατολισμό $\Delta \theta \in [-\pi/, +\pi/4]$ rad των
           στάσεων από όπου αυτές καταγράφηκαν, για αυξανόμενες τιμές της
           τυπικής απόκλισης των διαταραχών των πραγματικών μετρήσεων
           $\sigma_R$, και διαφθοράς του χαρτη $\sigma_{\bm{M}}$. Οι εκτιμήσεις
           στάσεις που είναι πιο κοντά στην πραγματική στάση από άποψη (α)
           προσανατολισμού και (β) θέσης παρουσιάζουν χαμηλότερες τιμές CAER
           από εκείνες που απέχουν περισσότερο από αυτήν}
  \label{fig:02_04_04:caer}
\end{figure}

Με την εισαγωγή της λειτουργίας δειγματοληψίας κατά Θησέα στη μέθοδο εκτίμησης
προσανατολισμού Πρώτων Αρχών, την αφαίρεση του υπολογισμού και σύγκρισης των
τιμών του Ποσοστού Διάκρισης, και την εισαγωγή της μετρικής CAER, καταφέρνουμε
να χτυπήσουμε με ένα σμπάρο δύο τριγώνια για όλες τις μεθόδους εκτίμησης
προσανατολισμού, διότι με αυτόν τον τρόπο:

\begin{itemize}
  \item ιδρύουμε έναν ορθολογικό μηχανισμό σύγκρισης των
        εκτιμήσεων προσανατολισμού της μεθόδου εκτίμησης προσανατολισμού Πρώτων
        Αρχών (Παρατηρήσεις \ref{remark:02_04_02:02} και
        \ref{remark:02_04_02:03})
  \item παρακάμπτουμε τον ύφαλο που δημιουργεί η σύγκριση τους μέσω της μετρικής
        Ποσοστού Διάκρισης για τις Προκρούστειες μεθόδους σε συνθήκες μη
        σύμπτωσης θέσεων (Παρατήρηση \ref{remark:02_04_02:04} )
\end{itemize}

Καθώς κάθε μέθοδος εξάγει πλέον $2^\nu$ εκτιμήσεις προσανατολισμού, όλες με την
ίδια εκτίμηση θέσης, συλλαμβάνοντας από την κάθε μία μία εικονική σάρωση εντός
του $\bm{M}$, και εισάγοντας την στη μετρική CAER, παράγεται μία τιμή που
αυξάνει για αυξανόμενο σφάλμα προσανατολισμού (σχήμα \ref{fig:02_04_04:caer},
πρώτη και τρίτη σειρά)---και αυτή η ιδιότητα διατηρείται στη γενική συνθήκη
όπου οι μετρήσεις του φυσικού αισθητήρα και η ταύτιση του χάρτη με το
περιβάλλον που αναπαριστά διαφθείρονται από θόρυβο.

Σε αυτό το σημείο έχουμε εκμεταλλευτεί μόνο την ιδιότητα της παρατήρησης
\ref{remark:02_04_02:01}. Για τον επιπρόσθετο διαχωρισμό ανάμεσα στις
εκτιμήσεις προσανατολισμού εκμεταλλευόμαστε την καμπυλότητα της CAER και την
ιδιότητα της παρατήρησης \ref{remark:loc_prop_or} με τον εξής τρόπο: δεδομένου
ότι εκτιμήσεις στάσης μεγαλύτερου σφάλματος  προσανατολισμού οδηγούν σε (α)
υψηλότερα σφάλματα θέσης όταν εισαχθούν στη μέθοδο εκτίμησης θέσης Πρώτων Αρχών
(Παρατήρηση \ref{remark:loc_prop_or}), και (β) υψηλότερες τιμές CAER, αν
εισάγουμε τις $2^\nu$ εκτιμήσεις στάσης που έχουν προέλθει από τις τρεις
μεθόδους εκτίμησης προσανατολισμού στη μέθοδο εκτίμησης θέσης για έναν
περιορισμένο αριθμό επαναλήψεων, τότε οι περισσότερο ανακριβείς ως προς τον
προσανατολισμό στάσεις θα οδηγηθούν σε περισσότερο ανακριβείς θέσεις, και, κατά
συνέπεια, οι εικονικές σαρώσεις που συλλαμβάνονται από αυτές θα οδηγήσουν σε
μεγαλύτερες τιμές CAER σε σχέση με τις λιγότερο ανακριβείς κατά προσανατολισμό
στάσεις. Αυτό το στάδιο δεν διενεργείται ώστε να υπολογισθεί η τελική εκτίμηση
θέσης, αλλά ως πρόβα αυτής, με τον αποκλειστικό σκοπό της διάκρισης της
εκτίμησης στάσης της οποίας το σφάλμα προσανατολισμού είναι το μικρότερο
ανάμεσα σε όλες τις $2^\nu$ εκτιμήσεις προσανατολισμού. Με αυτόν τον τρόπο
γίνεται εφικτό να εισαχθεί μόνο μία εκτίμηση στάσης από τις $2^\nu$ στη μέθοδο
εκτίμησης θέσης (αυτή με τη χαμηλότερη τιμή CAER), με αποτέλεσμα χαμηλότερο
χρόνο εκτέλεσης της από κοινού μεθόδου ευθυγράμμισης από ότι εάν εισάγονταν
όλες οι εκτιμήσεις στάσης στη μέθοδο εκτίμησης θέσης Πρώτων Αρχών.

\begin{figure}\centering
  \input{./figures/parts/02/chapters/04/sections/04/inner_rotation_system.tikz}
  \caption{\small Το μπλοκ διάγραμμα του τελικού συστήματος εκτίμησης
           προσανατολισμού του συστήματος ευθυγράμμισης πραγματικών με εικονικές
           σαρώσεις FSMSM}
  \label{fig:02_04_04:inner_rotation_system}
\end{figure}

\begin{algorithm}
  \caption{\texttt{caer-based\_orientation\_estimation}}
  \label{alg:02_04_04:rc}
  \begin{spacing}{1.5}
  \begin{algorithmic}[1]
    \REQUIRE \texttt{rc}, $\bm{M}$, $\mathcal{S}_R$, $\hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta})$, $\gamma$, $N_s$, $\nu$
    \ENSURE $\hat{\bm{p}}_C(\hat{x}, \hat{y}, \hat{\theta}_C)$
    \STATE \tikzmk{A}$\hat{\bm{P}}_{OE} \leftarrow \{\varnothing\}$
    \FOR{$k = 0 : 2^\nu-1$}
      \STATE $\hat{\bm{p}}_k \leftarrow (\hat{x}, \hat{y}, \hat{\theta} + k \cdot \gamma/2^\nu)$ \hfill (εξ. \ref{eq:theta_k_theseus})
      \STATE $\mathcal{S}_V^k \leftarrow \texttt{scan\_map}(\bm{M}, \hat{\bm{p}}_k, N_s)$ \hfill (Αλγόριθμος \ref{alg:scan_map})
      \STATE $\hat{\theta}^\prime \leftarrow \texttt{rcm}(\mathcal{S}_R, \mathcal{S}_V, \hat{\bm{p}}_k, \gamma)$ \hfill (Αλγόριθμος \ref{alg:02_04_04:rcm})
      \STATE $\hat{\theta}_k \leftarrow \hat{\theta}^\prime + k \cdot \gamma/2^\nu$
      \STATE $\texttt{append} \ \ (\hat{x}, \hat{y}, \hat{\theta}_k)$ to $\hat{\bm{P}}_{OE}$
      \STATE $k \leftarrow k + 1$
    \ENDFOR \tikzmk{B}\boxit{alg1}
    \STATE \tikzmk{A}$\hat{\bm{P}}_{RPE} \leftarrow \{\varnothing\}$
    \FOR{$k = 0 : 2^\nu-1$}
      \STATE $\hat{\bm{p}}_k^\prime \leftarrow \texttt{tc\_x1}(\bm{M}, \mathcal{S}_R, \hat{\bm{P}}_{OE}[k], 1, \infty, N_s)$ \hfill (Αλγόριθμος \ref{alg:icte})
      \STATE $\texttt{append} \ \ \hat{\bm{p}}_k^\prime$ to $\hat{\bm{P}}_{RPE}$
    \ENDFOR\tikzmk{B}\boxit{alg2}
    \STATE \tikzmk{A}$\bm{C} \leftarrow \{\varnothing\}$
    \FOR{$k = 0 : 2^\nu-1$}
      \STATE $\mathcal{S}_V^{k \prime} \leftarrow \texttt{scan\_map}(\bm{M}, \hat{\bm{P}}_{RPE}[k], N_s)$
      \STATE $\texttt{append} \ \ \texttt{CAER}(\mathcal{S}_R, \mathcal{S}_V^{k \prime})$ to $\bm{C}$ \hfill (εξ. \ref{eq:caer_normal})
    \ENDFOR\tikzmk{B}\boxit{alg3}
    \STATE $k_{\min} \leftarrow \arg\min \{\bm{C}\}$
    \STATE $\hat{\bm{p}}_C(\hat{x}, \hat{y}, \hat{\theta}_C) \leftarrow \hat{\bm{P}}_{OE}[k_{\min}]$
    \RETURN $\hat{\bm{p}}_C$
  \end{algorithmic}
  \end{spacing}
\end{algorithm}


\begin{algorithm}
  \caption{\texttt{rcm}}
  \label{alg:02_04_04:rcm}
  \begin{spacing}{1.5}
  \begin{algorithmic}[1]
    \REQUIRE \texttt{rc}, $\mathcal{S}_R, \mathcal{S}_V, \hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta}), \gamma$
    \ENSURE $\hat{\theta}^\prime$
    \IF{$\texttt{rc} = \texttt{rc\_fm}$}
      \STATE $(\hat{\theta}^\prime, \cdot) \leftarrow \texttt{rc\_fm}(\mathcal{S}_R, \mathcal{S}_V, \hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta}), \gamma)$ \hfill (Αλγόριθμος \ref{alg:algorithm_fmrc})
    \ELSIF{$\texttt{rc} = \texttt{rc\_x1}$}
      \STATE $\hat{\theta}^\prime \leftarrow \texttt{rc\_x1}(\mathcal{S}_R, \mathcal{S}_V, \hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta}))$ \hfill (Αλγόριθμος \ref{alg:algorithm_x1rc})
    \ELSIF{$\texttt{rc} = \texttt{rc\_uf}$}
      \STATE $(\hat{\theta}^\prime, \cdot) \leftarrow \texttt{rc\_uf}(\mathcal{S}_R, \mathcal{S}_V, \hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta}), \gamma)$ \hfill (Αλγόριθμος \ref{alg:algorithm_ufrc})
    \ENDIF
    \RETURN $\hat{\theta}^\prime$
  \end{algorithmic}
  \end{spacing}
\end{algorithm}


Πιο συγκεκριμένα: έστω τα δεδομένα του Προβλήματος \ref{prob:02_04}. Έστω
επίσης ένας βαθμός δειγματοληψίας του χάρτη $\nu \in \mathbb{Z}_{\geq 0}$. Τότε
το τελικό σύστημα εκτίμησης προσανατολισμού CAER-based Orientation Estimation,
το οποίο απεικονίζεται σε μπλοκ διάγραμμα στο σχήμα
\ref{fig:02_04_04:inner_rotation_system} και σε ψευδοκώδικα στον Αλγόριθμο
\ref{alg:02_04_04:rc}, υπολογίζει πρώτα $2^\nu$ εκτιμήσεις στάσης, οι οποίες
αποτελούν διατεταγμένα στοιχεία του συνόλου $\hat{\bm{P}}_{OE} = \{(\hat{x},
\hat{y}, \hat{\theta}_k)\}$, $k = 0,\dots,2^\nu-1$.  Όλες οι στάσεις του
$\hat{\bm{P}}_{OE}$ έχουν ίσες εκτιμήσεις θέσης, αλλά διαφορετικές εκτιμήσεις
προσανατολισμού. Η τελική εκτίμηση προσανατολισμού για κάθε υποψήφια αρχική
εκτίμηση προσανατολισμού $\hat{\theta}_k = \hat{\theta} + k \cdot \gamma
/2^\nu$ μεσολαβείται χρησιμοποιώντας έναν από τους βασικούς αλγορίθμους των
ενοτήτων \ref{subsection:02_04_02:01}, \ref{subsection:02_04_02:02}, και
\ref{subsection:02_04_02:03}, και ο δείκτης $k$ είναι ο δείκτης που καθορίζει
τη διάταξή τους στο σύνολο $\hat{\bm{P}}_{OE}$.

Προκειμένου να δημιουργηθεί μία ευκρινώς διαχωρισμένη ιεραρχία τιμών μετρικών
αξιολόγησης του σφάλματος των εκτιμήσεων προσανατολισμού, κάθε εκτίμηση στάσης
του $\hat{\bm{P}}_{OE}$ μεταφέρεται στο σύστημα εκτίμησης θέσης, όπου η θέση
κάθε εκτίμησης στάσης μετατοπίζεται μία φορά ($I_T = 1$), σύμφωνα με τον
Αλγόριθμο \ref{alg:icte}. Αυτή η λειτουργία, η οποία συμβολίζεται με τον τελεστή
RPE$(\cdot)$ στο σχήμα \ref{fig:02_04_04:inner_rotation_system}, παράγει το
σύνολο $\hat{\bm{P}}_{RPE} = \{(\hat{x}_k, \hat{y}_k, \hat{\theta}_k)\}$,
$|\hat{\bm{P}}_{RPE}| = 2^\nu$. Με την πρόβα εκτίμησης θέσης κάθε εκτίμησης
στάσης του $\hat{\bm{P}}_{OE}$ και την καταγραφή της τιμής CAER για κάθε μια
από τις μετατοπισμένες εκτιμήσεις στάσης του $\hat{\bm{P}}_{RPE}$, είναι
δυνατόν να καθοριστεί μια κατάταξη σφάλματος στάσης μεταξύ όλων των εκτιμήσεων
του συνόλου $\hat{\bm{P}}_{OE}$, και ταυτόχρονα να διατηρείται μόνο μία
εκτίμηση στάσης για την επόμενη επανάληψη της συνολικής μεθόδου
εκτίμησης.\footnote{Σε αντίθετη περίπτωση η διόρθωση της θέσης των $2^\nu$
εκτιμήσεων στάσης και η επανατροφοδότησή τους στο σύστημα θα προκαλούσε
εκθετικό κόστος σε χρόνο εκτέλεσης.} Η εκτίμηση στάσης $\hat{\bm{p}}_C \in
\hat{\bm{P}}_{OE}$ η οποία όταν μετατοπιστεί μία φορά καταγράφει την ελάχιστη
τιμή CAER μεταξύ όλων των παρομοίως μεταχειρισθέντων εκτιμήσεων στάσης του
$\hat{\bm{P}}_{OE}$ είναι αυτή που εξάγεται από το τελικό σύστημα εκτίμησης
προσανατολισμού.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Το σύστημα από κοινού ευθυγράμμισης}
\label{subsection:02_04_04:02}

Σε αυτή την ενότητα παρουσιάζουμε το τελικό γενικό σύστημα που στοχεύει στην
επίλυση του προβλήματος \ref{prob:02_04} και το οποίο είναι ικανό να
ενσωματώσει τη μέθοδο εκτίμησης προσανατολισμού της προηγούμενης ενότητας και
τη μέθοδο εκτίμησης θέσης (ενότητα \ref{section:02_04_03}). Το προτεινόμενο
σύστημα εκτιμά αρχικά τον προσανατολισμό του αισθητήρα (ισοδύναμα του ρομπότ
στον οποίο είναι προσαρτημένος---Παρατήρηση \ref{remark:smsm_benefit}), και στη
συνέχεια τη θέση του, ως προς το σύστημα συντεταγμένων του χάρτη $\bm{M}$. Ως
συνέπεια της παρατήρησης \ref{rem:iterative} η διαδικασία επαναλαμβάνεται
μέχρι την ικανοποίηση συνθήκης τερματισμού. Η μέθοδος αυτή περιγράφεται στα
ακόλουθα.

\begin{figure}\centering
  \input{./figures/parts/02/chapters/04/sections/04/inner_system.tikz}
  \caption{\small Η κεντρική μέθοδος εκτίμησης στάσης του FSMSM,
           One-step Pose Estimation}
  \label{fig:02_04_04:inner_system}
\end{figure}


\begin{figure}\centering
  \input{./figures/parts/02/chapters/04/sections/04/outer_system.tikz}
  \caption{\small Το διάγραμμα ροής του FSMSM. Η εκτέλεση αρχίζει με έναν αρχικό
           ελάχιστο βαθμό δειγματοληψίας του χάρτη $\nu_{\min}$, τη σάρωση
           $\mathcal{S}_R$ που καταγράφεται από τον φυσικό αισθητήρα, και το
           χάρτη $\bm{M}$ του περιβάλλοντος στο οποίο βρίσκεται το ρομπότ. Η
           αρχική εκτίμηση της στάσης παρέχεται από έναν παρατηρητή κατά τη
           διάρκεια εκτίμησης στάσης βάσει περιορισμένης αβεβαιότητος, ή με τη
           μορφή μιας υπόθεσης κατά τη διάρκεια εκτίμησης στάσης βάσει
           καθολικής αβεβαιότητος. Η εσωτερική μέθοδος One-step Pose Estimation
           (σχήμα \ref{fig:02_04_04:inner_system}) καλείται επαναληπτικά,
           ενημερώνοντας την εκτίμηση στάσης μέχρι να επιτευχθεί ένας μέγιστος
           βαθμός δειγματοληψίας, σύγκλιση της εκτίμησης, και ικανοποίηση
           κριτηρίων σύγκλισης. Σε περίπτωση απόκλισης, όπως για παράδειγμα
           στην περίπτωση που η εκτίμηση στάσης έχει μετατοπισθεί εκτός των
           ορίων του χάρτη, και σε περίπτωση που η τελική εκτίμηση δεν
           ικανοποιεί συνθήκες τερματισμού, τότε δημιουργείται με τυχαίο τρόπο
           μία νέα εκτίμηση στάσης και η διαδικασία εκτίμησης επανεκκινεί ως μη
           γενόμενη} \label{fig:02_04_04:outer_system}
\end{figure}

Έστω οι προϋποθέσεις του προβλήματος \ref{prob:02_04}, δηλαδή η αρχική εκτίμηση
εισόδου $\hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta})$, η πραγματική σάρωση
$\mathcal{S}_R$, και ο χάρτης $\bm{M}$. Τότε η μέθοδος ελάττωσης του συνολικού
σφάλματος εκτίμησης στάσης που προτείνουμε, την οποία ονομάζουμε Fourier
Scan--to--Map-Scan Matching (FSMSM) και η οποία παρουσιάζεται στο σχήμα
\ref{fig:02_04_04:outer_system}---η μέθοδος μειώνει το σφάλμα εκτίμησης με την
επαναληπτική εκτέλεση της διαδικασίας εκτίμησης στάσης ενός βήματος (One-step
Pose Estimation, OPE---σχήμα \ref{fig:02_04_04:inner_system}), μέχρι να
ικανοποιηθεί ένα σύνολο συνθηκών τερματισμού. Η FSMSM ξεκινά με ένα αρχικό
βαθμό δειγματοληψίας του χάρτη $\nu$ = $\nu_{\min}$. Η εκτίμηση της στάσης
εισόδου επεξεργάζεται από την OPE, και η έξοδός της $\hat{\bm{p}}^\prime$
εξετάζεται ως προς συνθήκες απόκλισης και σύγκλισης. Εάν η προκύπτουσα εκτίμηση
στάσης βρεθεί εκτός του χάρτη $\bm{M}$ τότε δημιουργείται με τυχαίο τρόπο μια
νέα εκτίμηση από την αρχική εκτίμηση $\hat{\bm{p}}$, και η διαδικασία
επανεκκινεί, με αρχική εκτίμηση τη νέα. Εάν δεν παρατηρείται σημαντική διόρθωση
της εκτίμησης $\|\hat{\bm{p}}^\prime-\hat{\bm{p}}\|_2 < \varepsilon_{\delta
p}$, τότε ο βαθμός δειγματοληψίας του χάρτη $\nu$ αυξάνεται και η τελευταία
εκτίμηση της OPE της τροφοδοτείται ως νέα αρχική συνθήκη. Η αύξησή του βαθμού
δειγματοληψίας χρησιμεύει ως μέσο μείωσης του σφάλματος προσανατολισμού και
συνεπώς του σφάλματος εκτίμησης θέσης (Παρατηρήσεις \ref{remark:02_04_02:01}
και \ref{remark:loc_prop_or}). Διαφορετικά η παραπάνω διαδικασία
επαναλαμβάνεται με νέα αρχική εκτίμηση την τελευταία της OPE έως ότου δεν
παρατηρηθεί σημαντική διόρθωση. Η διαδικασία επαναλαμβάνεται έως ότου
επιτευχθεί μέγιστος βαθμός δειγματοληψίας χάρτη $\nu$ = $\nu_{\max}$, οπότε η
FSMSM τερματίζει εάν πληρούται μια τελική συνθήκη. Αυτή η τελική συνθήκη
διευκολύνει την αποφυγή τοπικών μεγίστων. Στην περίπτωση που αυτή η συνθήκη δεν
ικανοποιείται, δημιουργείται και πάλι με τυχαίο τρόπο μία νέα στάση και η
διαδικασία επανεκκινεί.


Η κεντρική μέθοδος One-step Pose Estimation χρησιμοποιεί τη μέθοδο εκτίμησης
προσανατολισμού της ενότητας \ref{subsection:02_04_04:01} και τη μέθοδο
εκτίμησης θέσης της ενότητας \ref{section:02_04_03}.  Στην τελευταία ο αριθμός
των επαναλήψεων $I_T$ είναι αύξουσα συνάρτηση του βαθμού δειγματοληψίας του
χάρτη $\nu$ ($I_T = f(\nu)$ στο σχήμα
\ref{fig:02_04_04:inner_system}).\footnote{Η λογική της αλυσιδωτής σύνδεσης του
αριθμού των επαναλήψεων της με το βαθμό δειγματοληψίας του χάρτη $\nu$ είναι η
ακόλουθη. Δεδομένου ότι το σφάλμα προσανατολισμού είναι αντιστρόφως ανάλογο του
$\nu$, σε χαμηλούς βαθμούς δειγματοληψίας χάρτη, όταν το σφάλμα εκτίμησης θέσης
είναι στα υψηλότερά του επίπεδα, εάν ο αριθμός των επαναλήψεων ήταν υψηλός τότε
η εκτίμηση της θέσης θα ήταν ευάλωτη σε απόκλιση.  Επομένως ο αριθμός των
επαναλήψεων διατηρείται χαμηλός στα αρχικά στάδια έτσι ώστε να υπάρχει
ισορροπία μεταξύ της μείωσης του σφάλματος θέσης και της απόκλισης της
εκτίμησης θέσης. Σε υψηλότερες τιμές του $\nu$ το σφάλμα εκτίμησης
προσανατολισμού έχει μειωθεί, και στη συνέχεια η απόκλιση περιορίζεται ή/και
επιτυγχάνεται σε υψηλότερες τιμές επανάληψης $I_T$. Καθώς η εκτίμηση
προσανατολισμού γίνεται όλο και πιο ακριβής, το σύστημα εκτίμησης θέσης
αφήνεται να επαναλάβει τη διαδικασία του περισσότερες φορές ώστε να είναι
εφικτή η περαιτέρω μείωση του σφάλματος θέσης.} Το σύστημα εκτίμησης θέσης
παράγει την εκτίμηση στάσης $\hat{\bm{p}}^\prime$, η οποία στη συνέχεια
τροφοδοτείται πίσω στο σύστημα εκτίμησης προσανατολισμού με τη μορφή της νέας
του εκτίμησης στάσης: $\hat{\bm{p}} \leftarrow \hat{\bm{p}}^\prime$. Στην
πράξη το σύνολο στάσεων $\hat{\bm{P}}_{OE}$ συμπληρώνεται με μία στάση της
οποίας η θέση είναι ίση με $\hat{\bm{p}}$, και της οποίας ο προσανατολισμός
είναι ίσος με τον προσανατολισμό της $\hat{\bm{p}}_C$ που παράγει την ελάχιστη
τιμή CAER με την πάροδο του χρόνου. Αυτή η προσθήκη εισάγει μια μορφή μνήμης
στο σύστημα, η οποία το βοηθά στην αποφυγή αποκλίσεων και η οποία, ως εκ
τούτου, ωφελεί την ταχύτητα εκτέλεσης. Ο αλγόριθμος \ref{alg:algorithm_fsmsm}
παρουσιάζει σε ψευδοκώδικα τα βήματα εκτέλεσης του FSMSM.

\begin{algorithm}
  \caption{\texttt{FSMSM}}
  \label{alg:algorithm_fsmsm}
  \begin{spacing}{1.5}
  \begin{algorithmic}[1]
    \REQUIRE $\mathcal{S}_R$, $\mathbb{M}$, $\hat{\bm{p}}$, $\texttt{rc}$,  $\gamma$, $N_s$, $\nu_{\min}$, $\nu_{\max}$, $I_T$, $\varepsilon_{\delta p}$, $\overline{c}$
    \ENSURE $\hat{\bm{p}}(\hat{x}, \hat{y}, \hat{\theta})$
    \STATE $\nu \leftarrow \nu_{\min}$
    \WHILE {$\nu \leq \nu_{\max}$}
      \STATE $\hat{\bm{p}}_C \leftarrow \texttt{caer-based\_orientation\_estimation}(\texttt{rc}, \bm{M}, \mathcal{S}_R, \hat{\bm{p}}, \gamma, N_s, \nu)$ \hfill (Αλγ. \ref{alg:02_04_04:rc})
      \STATE $\hat{\bm{p}}^{\prime} \leftarrow \texttt{tc\_x1}(\bm{M}, \mathcal{S}_R, \hat{\bm{p}}_C, I_T, \infty, N_s)$  \hfill (Αλγόριθμος \ref{alg:icte})
       \IF{\tikzmk{A} $\hat{\bm{p}}^{\prime}$ not in $\bm{M}$}
        \STATE generate new $\hat{\bm{p}}$; $\nu \leftarrow \nu_{\min}$; \texttt{continue}
      \ENDIF \tikzmk{B}\boxit{alg4}
       \IF{\tikzmk{A} $\|\hat{\bm{p}}^{\prime} - \hat{\bm{p}}\| < \varepsilon_{\delta p}$}
        \STATE $\nu \leftarrow \nu + 1$
      \ENDIF \tikzmk{B}\boxit{alg5}
       \IF{\tikzmk{A} $\nu = \nu_{\max}$}
        \IF{$\texttt{CAER}(\mathcal{S}_R, \texttt{scan\_map}(\bm{M}, \hat{\bm{p}}^\prime)) \not\leq \overline{c}$}
          \STATE generate new $\hat{\bm{p}}$; $\nu \leftarrow \nu_{\min}$; \texttt{continue}
        \ELSE
          \STATE $\hat{\bm{p}} \leftarrow \hat{\bm{p}}^{\prime}$; \texttt{break}
        \ENDIF
      \ENDIF \tikzmk{B}\boxit{alg6}
      \STATE $\hat{\bm{p}} \leftarrow \hat{\bm{p}}^{\prime}$
    \ENDWHILE
    \RETURN $\hat{\bm{p}}$
  \end{algorithmic}
  \end{spacing}
\end{algorithm}
